<!DOCTYPE html>
<html>
<head>
    <title>Star Wars Navigation Chart</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Mapbox GL JS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js"></script>

    <!-- Custom styles -->
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="./style.css" type="text/css">
</head>
<body>
    <div id="map" style="width: 100%; height: 100vh;"></div>
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search a system">
        <button id="search-button">Search</button>
    </div>
    <div class="toggle-background-container">
        <button id="toggle-background"><i class="fas fa-star"></i></button>
    </div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibmVzcCIsImEiOiJjbHg1dDE5Mm4xY2h5Mmlxc2R2Mm95Y3ByIn0.Kp1Lcr9XD_u6oy8QOpvOZQ';

        var map = new mapboxgl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'space-background': {
                        type: 'raster',
                        tiles: ['./XYZ_Space/{z}/{x}/{y}.png'],
                        tileSize: 256,
                        minzoom: 16,
                        maxzoom: 22
                    },
                    'white-background': {
                        type: 'raster',
                        tiles: ['./XYZ/{z}/{x}/{y}.png'],
                        tileSize: 256,
                        minzoom: 16,
                        maxzoom: 22
                    },
                    'systems': {
                        type: 'geojson',
                        data: './layers/systems.geojson'
                    },
                    'routes': {
                        type: 'geojson',
                        data: './layers/routes.geojson'
                    }
                },
                layers: [
                    {
                        id: 'space-background',
                        type: 'raster',
                        source: 'space-background',
                        layout: { visibility: 'visible' }
                    },
                    {
                        id: 'white-background',
                        type: 'raster',
                        source: 'white-background',
                        layout: { visibility: 'none' }
                    },
                    {
                        id: 'systems',
                        type: 'circle',
                        source: 'systems',
                        paint: {
                            'circle-radius': 5,
                            'circle-color': '#f00',
                            'circle-opacity': 0 // Initially hidden
                        }
                    },
                    {
                        id: 'routes',
                        type: 'line',
                        source: 'routes',
                        paint: {
                            'line-color': '#000',
                            'line-opacity': 0 // Initially hidden
                        }
                    }
                ]
            },
            center: [0.00847486, -0.0109944],
            zoom: 18
        });

        // Toggle background functionality
        var currentBackground = 'space-background';

        document.getElementById('toggle-background').addEventListener('click', function() {
            var newBackground = currentBackground === 'space-background' ? 'white-background' : 'space-background';
            map.setLayoutProperty(currentBackground, 'visibility', 'none');
            map.setLayoutProperty(newBackground, 'visibility', 'visible');
            currentBackground = newBackground;
        });

        // Search functionality
        document.getElementById('search-button').addEventListener('click', function() {
            const searchInput = document.getElementById('search-input').value.trim();
            if (!searchInput) {
                alert('Please enter a system name');
                return;
            }

            const searchWords = searchInput.toLowerCase().split(' ');

            const features = map.querySourceFeatures('systems');
            let foundFeature = null;

            for (const feature of features) {
                const featureName = feature.properties.NAME;
                if (!featureName) continue;
                const nameWords = featureName.toLowerCase().split(' ');

                const allWordsMatch = searchWords.every(searchWord =>
                    nameWords.some(nameWord => nameWord.includes(searchWord))
                );

                if (allWordsMatch) {
                    foundFeature = feature;
                    break;
                }
            }

            if (foundFeature) {
                const coordinates = foundFeature.geometry.coordinates;
                map.flyTo({ center: coordinates, zoom: 20 });
            } else {
                alert('System not found');
                map.setZoom(18); // Reset zoom if not found
            }
        });
    </script>
</body>
</html>
